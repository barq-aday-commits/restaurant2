<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ù…Ø·Ø¹Ù… Ø´Ø· Ø§Ù„Ø¹Ø±Ø¨ | Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø°ÙƒÙŠ</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --rust: #b7410e; --bronze: #cd7f32; --dark: #1a1a1a; --silver: #f4f4f4; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { background-color: var(--silver); padding-bottom: 100px; }

        header { background: var(--dark); color: white; text-align: center; padding: 20px; border-bottom: 3px solid var(--bronze); }
        
        .menu-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; padding: 20px; }
        .card { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center; }
        .card img { width: 100%; height: 120px; object-fit: cover; }
        .card-body { padding: 10px; }
        .price { color: var(--rust); font-weight: bold; display: block; margin: 5px 0; }
        
        .add-btn { background: var(--rust); color: white; border: none; padding: 8px; border-radius: 5px; cursor: pointer; width: 100%; font-weight: bold; }

        /* Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        .cart-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: white;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1); padding: 15px; display: flex;
            justify-content: space-between; align-items: center; z-index: 1000;
        }
        .order-now-btn { background: #25D366; color: white; padding: 12px 25px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }

        /* Ù†Ø§ÙØ°Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²Ø¨ÙˆÙ† */
        #checkout-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; z-index: 2000; justify-content: center; align-items: center;
        }
        .form-box { background: white; padding: 20px; border-radius: 15px; width: 90%; max-width: 400px; }
        .form-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
        .final-btn { background: #25D366; color: white; width: 100%; padding: 15px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<header><h1>Ø´Ø· Ø§Ù„Ø¹Ø±Ø¨</h1></header>

<div class="menu-container" id="food-list">
    </div>

<div class="cart-bar" id="cart-bar" style="display: none;">
    <div>
        <span id="cart-count">0</span> ÙˆØ¬Ø¨Ø§Øª | 
        <span id="cart-total" style="color: var(--rust); font-weight: bold;">0</span> Ø¯.Ø¹
    </div>
    <button class="order-now-btn" onclick="openCheckout()">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
</div>

<div id="checkout-modal">
    <div class="form-box">
        <h3>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</h3>
        <div id="cart-summary" style="font-size: 0.8rem; color: #666; margin: 10px 0;"></div>
        <input type="text" id="cust-name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
        <input type="tel" id="cust-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        <input type="text" id="cust-address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
        <button class="final-btn" onclick="sendToWhatsapp()">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button onclick="closeCheckout()" style="background:none; border:none; color:grey; width:100%; margin-top:10px;">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>

<script>
const _k = '1laj-jG9Q18PIEkUivgsTG_iZN4nrbZsAnLu_9ZuMyk0'; // Ø¢ÙŠØ¯ÙŠ Ø§Ù„Ø´ÙŠØª
const _u = `https://docs.google.com/spreadsheets/d/${_k}/gviz/tq?tqx=out:json`;
const phoneNum = "9647887603449"; // Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨

let cart = [];

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ÙŠÙˆ
fetch(_u).then(r => r.text()).then(d => {
    const j = JSON.parse(d.substring(47, d.length - 2));
    const rows = j.table.rows;
    const list = document.getElementById('food-list');
    list.innerHTML = '';

    for (let i = 1; i < rows.length; i++) {
        const c = rows[i].c;
        const dish = {
            n: c[0] ? c[0].v : '',
            p: c[2] ? parseFloat(c[2].v) : 0,
            im: c[3] ? c[3].v : ''
        };

        if(dish.n) {
            list.innerHTML += `
                <div class="card">
                    <img src="${dish.im}">
                    <div class="card-body">
                        <h3>${dish.n}</h3>
                        <span class="price">${dish.p} Ø¯.Ø¹</span>
                        <button class="add-btn" onclick="addToCart('${dish.n}', ${dish.p})">+ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button>
                    </div>
                </div>`;
        }
    }
});

function addToCart(name, price) {
    cart.push({ name, price });
    updateCartBar();
}

function updateCartBar() {
    const bar = document.getElementById('cart-bar');
    const total = cart.reduce((sum, item) => sum + item.price, 0);
    document.getElementById('cart-count').innerText = cart.length;
    document.getElementById('cart-total').innerText = total;
    bar.style.display = cart.length > 0 ? 'flex' : 'none';
}

function openCheckout() {
    let summary = cart.map(item => item.name).join(" + ");
    document.getElementById('cart-summary').innerText = "Ø·Ù„Ø¨Ø§ØªÙƒ: " + summary;
    document.getElementById('checkout-modal').style.display = 'flex';
}

function closeCheckout() { document.getElementById('checkout-modal').style.display = 'none'; }

function sendToWhatsapp() {
    const name = document.getElementById('cust-name').value;
    const phone = document.getElementById('cust-phone').value;
    const addr = document.getElementById('cust-address').value;
    const total = cart.reduce((sum, item) => sum + item.price, 0);

    if(!name || !phone || !addr) { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹"); return; }

    let itemsText = cart.map(item => `- ${item.name} (${item.price} Ø¯.Ø¹)`).join("\n");
    
    const msg = `*Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹* ğŸ›’\n\n` +
                `*Ø§Ù„Ø£ØµÙ†Ø§Ù:*\n${itemsText}\n` +
                `-------------------\n` +
                `*Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ:* ${total} Ø¯.Ø¹\n\n` +
                `*Ø§Ù„Ø§Ø³Ù…:* ${name}\n` +
                `*Ø§Ù„Ù‡Ø§ØªÙ:* ${phone}\n` +
                `*Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:* ${addr}`;

    window.open(`https://wa.me/${phoneNum}?text=${encodeURIComponent(msg)}`);
    cart = []; // ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ù„Ø¨
    updateCartBar();
    closeCheckout();
}
</script>
</body>
</html>
